<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8">
<title>Losowo generowana mapa</title>
<style>
  body {
    margin: 0;
    background: #111;
    display: grid;
    place-items: center;
    height: 100vh;
  }
  canvas {
    image-rendering: pixelated;
    border-radius: 12px;
    box-shadow: 0 20px 60px rgba(0,0,0,.6);
  }
</style>
</head>
<body>

<canvas id="c"></canvas>

<script>
/* =========================
   USTAWIENIA
========================= */
const TILE_SIZE = 64;      // dopasuj jeśli chcesz mniejsze
const MAP_W = 25;
const MAP_H = 14;

/* =========================
   KAFELKI
========================= */
const TILESET = {
  water:  "woda.png",
  sand:   "piasek.png",
  grass:  "better trawa.png",
  dirt:   "ziemia.png",
  rock:   "skalista.png"
};

/* =========================
   ŁADOWANIE OBRAZÓW
========================= */
function loadImage(src) {
  return new Promise(res => {
    const i = new Image();
    i.onload = () => res(i);
    i.src = src;
  });
}

/* =========================
   SEED + RNG
========================= */
function mulberry32(a) {
  return function() {
    let t = a += 0x6D2B79F5;
    t = Math.imul(t ^ t >>> 15, t | 1);
    t ^= t + Math.imul(t ^ t >>> 7, t | 61);
    return ((t ^ t >>> 14) >>> 0) / 4294967296;
  };
}

/* =========================
   NOISE (value noise + fbm)
========================= */
function smooth(t){ return t*t*(3-2*t); }
function lerp(a,b,t){ return a+(b-a)*t; }

function hash(x,y){
  return ((x*73856093)^(y*19349663))>>>0;
}

function noise(x,y){
  const x0=Math.floor(x), y0=Math.floor(y);
  const x1=x0+1, y1=y0+1;
  const sx=smooth(x-x0), sy=smooth(y-y0);

  const n00=mulberry32(hash(x0,y0))();
  const n10=mulberry32(hash(x1,y0))();
  const n01=mulberry32(hash(x0,y1))();
  const n11=mulberry32(hash(x1,y1))();

  return lerp(
    lerp(n00,n10,sx),
    lerp(n01,n11,sx),
    sy
  );
}

function fbm(x,y){
  let v=0, a=0.5, f=1, s=0;
  for(let i=0;i<5;i++){
    v+=a*noise(x*f,y*f);
    s+=a;
    a*=0.5;
    f*=2;
  }
  return v/s;
}

/* =========================
   GENEROWANIE MAPY
========================= */
function generate(seed){
  const rand = mulberry32(seed);
  const ox = rand()*1000;
  const oy = rand()*1000;

  const map=[];
  for(let y=0;y<MAP_H;y++){
    map[y]=[];
    for(let x=0;x<MAP_W;x++){
      const n = fbm((x+ox)/25,(y+oy)/25);

      let t =
        n < 0.30 ? "water" :
        n < 0.38 ? "sand"  :
        n < 0.65 ? "grass" :
        n < 0.82 ? "dirt"  :
                   "rock";

      map[y][x]=t;
    }
  }
  return map;
}

/* =========================
   START
========================= */
(async ()=>{
  const canvas = document.getElementById("c");
  canvas.width  = MAP_W*TILE_SIZE;
  canvas.height = MAP_H*TILE_SIZE;
  const ctx = canvas.getContext("2d");

  const tiles={};
  for(const k in TILESET)
    tiles[k]=await loadImage(TILESET[k]);

  function draw(){
    const map = generate(Math.random()*1e9);
    for(let y=0;y<MAP_H;y++)
      for(let x=0;x<MAP_W;x++)
        ctx.drawImage(
          tiles[map[y][x]],
          x*TILE_SIZE,
          y*TILE_SIZE,
          TILE_SIZE,
          TILE_SIZE
        );
  }

  draw();
  window.onclick = draw; // klik = nowa mapa
})();
</script>
</body>
</html>